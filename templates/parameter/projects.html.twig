{% extends 'base.html.twig' %}

{% block title %}Digi-3 - Gestion des projets{% endblock %}

{% block body %}
{% include 'includes/header.html.twig' with {'user': user} %}

<section class="parameter_landing flex">
    {% include 'parameter/_menu.html.twig' %}
    <div class="parameter_content">
        <div class="projects-page">
            <div class="projects-header flex">
                <h2>Gestion des projets</h2>
                {% if not is_granted('ROLE_DEV') %}
                <button class="btn-add" data-bs-toggle="modal" data-bs-target="#addProjectModal">
                    Ajouter un projet
                </button>
                {% endif %}
            </div>

            {% for message in app.flashes('success') %}
                <div class="alert-success">{{ message }}</div>
            {% endfor %}
            {% for message in app.flashes('error') %}
                <div class="alert-error">{{ message }}</div>
            {% endfor %}

            <div class="projects-table">
                <table>
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Description</th>
                            <th>Complexité</th>
                            <th>Priorité</th>
                            <th>Date début</th>
                            <th>Date fin</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects %}
                            <tr>
                                <td>{{ project.taskName }}</td>
                                <td>{{ project.taskText }}</td>
                                <td>{{ project.taskComplexity }}</td>
                                <td>{{ project.taskPriority }}</td>
                                <td>{{ project.taskTargetStartDate ? project.taskTargetStartDate|date('d/m/Y') : '' }}</td>
                                <td>{{ project.taskTargetEndDate ? project.taskTargetEndDate|date('d/m/Y') : '' }}</td>
                                <td class="actions">
                                    <button class="btn-edit edit-project" 
                                            data-project-id="{{ project.id }}"
                                            data-bs-toggle="modal" 
                                            data-bs-target="#editProjectModal">
                                        <img src="{{ asset('img/icons/edit.png') }}" alt="Modifier" style="height: 50px; width: 50px; object-fit: contain;">
                                    </button>
                                    <button class="btn-delete delete-project" 
                                            data-project-id="{{ project.id }}"
                                            data-bs-toggle="modal" 
                                            data-bs-target="#deleteProjectModal">
                                        <img src="{{ asset('img/icons/delete.png') }}" alt="Supprimer" style="height: 50px; width: 50px; object-fit: contain;">
                                    </button>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="7" class="no-data">Aucun projet trouvé</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

{# Add Project Modal #}
<div class="modal fade" id="addProjectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter un projet</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addProjectForm" class="flex-col">
                    <div class="form-group">
                        <label for="name">Nom du projet</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="complexity">Complexité</label>
                        <select id="complexity" name="complexity" required>
                            <option value="FAIBLE">Faible</option>
                            <option value="MOYENNE">Moyenne</option>
                            <option value="ELEVEE">Élevée</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priority">Priorité</label>
                        <select id="priority" name="priority" required>
                            <option value="BASSE">Basse</option>
                            <option value="NORMALE">Normale</option>
                            <option value="HAUTE">Haute</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="targetStartDate">Date de début prévue</label>
                        <input type="date" id="targetStartDate" name="targetStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="targetEndDate">Date de fin prévue</label>
                        <input type="date" id="targetEndDate" name="targetEndDate" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn-submit" id="saveNewProject">Enregistrer</button>
            </div>
        </div>
    </div>
</div>

{# Delete Project Modal #}
<div class="modal fade" id="deleteProjectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmer la suppression</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Êtes-vous sûr de vouloir supprimer ce projet ?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn-delete" id="confirmDelete">Supprimer</button>
            </div>
        </div>
    </div>
</div>

{% block javascripts %}
<script src="{{ asset('script/parameter/parameter.js') }}"></script>
{% endblock %}
{% endblock %}